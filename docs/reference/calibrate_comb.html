<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Combined calibration of model to multiple types of data — calibrate_comb • McMasterPandemic</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Combined calibration of model to multiple types of data — calibrate_comb" />
<meta property="og:description" content="Top-level calibration based on mobility, splines, and
phenomenological heterogeneity.  This function is a wrapper for
calibrate, which first sets up the model matrix for
time-dependent transmission rates \(\beta(t)\).  For example,
for splines, it sets up the spline basis and the coefficients of
each basis function.  For mobility, it sets up the slope and
intercept parameters (since mobility is treated as a log-linear
function between break points)." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">McMasterPandemic</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.19.002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/calibration.html">Model calibration</a>
    </li>
    <li>
      <a href="../articles/getting_started.html">getting started</a>
    </li>
    <li>
      <a href="../articles/model.html">The 'McMaster Pandemic' model</a>
    </li>
    <li>
      <a href="../articles/testing_flow.html">Incorporating testing dynamics in the MacPan model</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bbolker/McMasterPandemic/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Combined calibration of model to multiple types of data</h1>
    <small class="dont-index">Source: <a href='https://github.com/bbolker/McMasterPandemic/blob/master/R/calibrate.R'><code>R/calibrate.R</code></a></small>
    <div class="hidden name"><code>calibrate_comb.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Top-level calibration based on mobility, splines, and
phenomenological heterogeneity.  This function is a wrapper for
<code><a href='calibrate.html'>calibrate</a></code>, which first sets up the model matrix for
time-dependent transmission rates \(\beta(t)\).  For example,
for splines, it sets up the spline basis and the coefficients of
each basis function.  For mobility, it sets up the slope and
intercept parameters (since mobility is treated as a log-linear
function between break points).</p>
    </div>

    <pre class="usage"><span class='fu'>calibrate_comb</span><span class='op'>(</span>
  <span class='va'>data</span>,
  <span class='va'>params</span>,
  opt_pars <span class='op'>=</span> <span class='cn'>NULL</span>,
  mob_data <span class='op'>=</span> <span class='cn'>NULL</span>,
  mob_breaks <span class='op'>=</span> <span class='cn'>NULL</span>,
  mob_breaks_int <span class='op'>=</span> <span class='cn'>FALSE</span>,
  mob_logist_scale <span class='op'>=</span> <span class='cn'>NA</span>,
  spline_days <span class='op'>=</span> <span class='fl'>14</span>,
  spline_setback <span class='op'>=</span> <span class='fl'>0</span>,
  spline_extrap <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"linear"</span>, <span class='st'>"constant"</span><span class='op'>)</span>,
  spline_df <span class='op'>=</span> <span class='cn'>NA</span>,
  knot_quantile_var <span class='op'>=</span> <span class='cn'>NA</span>,
  spline_pen <span class='op'>=</span> <span class='fl'>0</span>,
  spline_type <span class='op'>=</span> <span class='st'>"bs"</span>,
  spline_int <span class='op'>=</span> <span class='cn'>FALSE</span>,
  testing_data <span class='op'>=</span> <span class='cn'>NULL</span>,
  maxit <span class='op'>=</span> <span class='fl'>10000</span>,
  skip.hessian <span class='op'>=</span> <span class='cn'>FALSE</span>,
  use_DEoptim <span class='op'>=</span> <span class='cn'>TRUE</span>,
  DE_cores <span class='op'>=</span> <span class='fl'>1</span>,
  beta_break_dates <span class='op'>=</span> <span class='cn'>NULL</span>,
  use_mobility <span class='op'>=</span> <span class='cn'>FALSE</span>,
  use_phenomhet <span class='op'>=</span> <span class='cn'>FALSE</span>,
  use_spline <span class='op'>=</span> <span class='cn'>FALSE</span>,
  use_testing <span class='op'>=</span> <span class='cn'>FALSE</span>,
  vars <span class='op'>=</span> <span class='cn'>NULL</span>,
  debug_plot <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/interactive.html'>interactive</a></span><span class='op'>(</span><span class='op'>)</span>,
  debug <span class='op'>=</span> <span class='cn'>FALSE</span>,
  debug_hist <span class='op'>=</span> <span class='cn'>FALSE</span>,
  return_val <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"fit"</span>, <span class='st'>"X"</span>, <span class='st'>"formula"</span>, <span class='st'>"args"</span>, <span class='st'>"time_args"</span><span class='op'>)</span>,
  start_date <span class='op'>=</span> <span class='cn'>NULL</span>,
  priors <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>a data set to compare to, containing date/var/value
(current version assumes that only a single state var is
included)</p></td>
    </tr>
    <tr>
      <th>params</th>
      <td><p>parameters</p></td>
    </tr>
    <tr>
      <th>opt_pars</th>
      <td><p>starting parameters (and structure).  Parameters
that are part of the <code>params_pansim</code> parameter vector can
be specified within the <code>params</code> element (with prefixes
if they are transformed); other parameters can include
distributional parameters or time-varying parameters</p></td>
    </tr>
    <tr>
      <th>mob_data</th>
      <td><p>mobility data</p></td>
    </tr>
    <tr>
      <th>mob_breaks</th>
      <td><p>vector of breakpoints for piecewise mobility
model</p></td>
    </tr>
    <tr>
      <th>mob_breaks_int</th>
      <td><p>(logical) specifies whether the intercept of
the mobility/transmission relationship changes at each
mobility breakpoint. The default (<code>FALSE</code>) specifies that
mobility in 'mobility period' <code>i</code> is
<code>beta0*(rel_mobility)^p_i</code>; <code>TRUE</code> would specify
<code>beta0*(a_i)*(rel_mobility)^p_i</code>, with <code>a_1==1</code>.</p></td>
    </tr>
    <tr>
      <th>mob_logist_scale</th>
      <td><p>specifies the scale of the smooth
(logistic) transition between mobility periods, in days: if it
is <code>NA</code> (default), the model uses sharp breaks for a
piecewise-constant model.  Otherwise, the parameter used makes
a logistic transition between the two periods with the
specified scale.</p></td>
    </tr>
    <tr>
      <th>spline_days</th>
      <td><p>days between spline knots</p></td>
    </tr>
    <tr>
      <th>spline_setback</th>
      <td><p>days before end of time series to set
boundary knots for spline (this implies <em>linear</em>
extrapolation after knots if <code>spline_type="ns"</code> is
specified, which is probably wise)</p></td>
    </tr>
    <tr>
      <th>spline_extrap</th>
      <td><p>spline extrapolation model ("linear" or
"constant")</p></td>
    </tr>
    <tr>
      <th>spline_df</th>
      <td><p>overall spline degrees of freedom</p></td>
    </tr>
    <tr>
      <th>knot_quantile_var</th>
      <td><p>variable to use cum dist for knotspacing</p></td>
    </tr>
    <tr>
      <th>spline_pen</th>
      <td><p>penalization for spline</p></td>
    </tr>
    <tr>
      <th>spline_type</th>
      <td><p>spline type ("ns" for natural spline or "bs"
for b-spline)</p></td>
    </tr>
    <tr>
      <th>spline_int</th>
      <td><p>spline intercept (??)</p></td>
    </tr>
    <tr>
      <th>testing_data</th>
      <td><p>data frame with columns containing dates
(<code>Date</code>) and testing intensity (<code>intensity</code>) (=
tests per capita per day)</p></td>
    </tr>
    <tr>
      <th>maxit</th>
      <td><p>maximum iterations for Nelder-Mead/optimization step</p></td>
    </tr>
    <tr>
      <th>skip.hessian</th>
      <td><p>skip Hessian calculation?</p></td>
    </tr>
    <tr>
      <th>use_DEoptim</th>
      <td><p>use differential evolution as first stage?</p></td>
    </tr>
    <tr>
      <th>DE_cores</th>
      <td><p>number of parallel workers for DE</p></td>
    </tr>
    <tr>
      <th>beta_break_dates</th>
      <td><p>discrete break dates for transmission changes</p></td>
    </tr>
    <tr>
      <th>use_mobility</th>
      <td><p>include mobility as a covariate in the model?</p></td>
    </tr>
    <tr>
      <th>use_phenomhet</th>
      <td><p>include phenomenological heterogeneity?</p></td>
    </tr>
    <tr>
      <th>use_spline</th>
      <td><p>include spline?</p></td>
    </tr>
    <tr>
      <th>use_testing</th>
      <td><p>include variation in testing intensity?</p></td>
    </tr>
    <tr>
      <th>vars</th>
      <td><p>which vars to use? (default is all in data)</p></td>
    </tr>
    <tr>
      <th>debug_plot</th>
      <td><p>plot debugging curves? (doesn't work with
parallel DEoptim)</p></td>
    </tr>
    <tr>
      <th>debug</th>
      <td><p>print debugging messages?</p></td>
    </tr>
    <tr>
      <th>debug_hist</th>
      <td><p>keep information on parameter history?</p></td>
    </tr>
    <tr>
      <th>return_val</th>
      <td><p>"fit" (return calibrated value); "X"
(short-circuit/return model matrix?); "formula" (return
log-linear formula for time-varying beta)</p></td>
    </tr>
    <tr>
      <th>start_date</th>
      <td><p>start date</p></td>
    </tr>
    <tr>
      <th>priors</th>
      <td><p>a list of tilde-delimited expressions giving prior
distributions expressed in terms of the elements of
<code>opt_pars</code>,
e.g. <code><a href='https://rdrr.io/r/base/list.html'>list(~dlnorm(rel_beta0[1],meanlog=-1,sd=0.5))</a></code></p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>extra args</p></td>
    </tr>
    </table>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>dd</span> <span class='op'>&lt;-</span> <span class='va'>ont_all</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='trans_state_vars.html'>trans_state_vars</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
       <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>var</span> <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"H"</span>,<span class='st'>"report"</span><span class='op'>)</span><span class='op'>)</span>
 <span class='va'>params</span> <span class='op'>&lt;-</span> <span class='fu'><a href='read_params.html'>read_params</a></span><span class='op'>(</span><span class='st'>"ICU1.csv"</span><span class='op'>)</span>
 <span class='co'>## quick and dirty example (maximize speed)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
 <span class='fu'>calibrate_comb</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>dd</span>, params<span class='op'>=</span><span class='va'>params</span>,
               use_spline<span class='op'>=</span><span class='cn'>TRUE</span>,
              maxit<span class='op'>=</span><span class='fl'>10</span>, skip.hessian<span class='op'>=</span><span class='cn'>TRUE</span>, use_DEoptim <span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span>
<span class='va'>X</span> <span class='op'>&lt;-</span>  <span class='fu'>calibrate_comb</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>dd</span>, params<span class='op'>=</span><span class='va'>params</span>,
              use_spline<span class='op'>=</span><span class='cn'>TRUE</span>,
              spline_type<span class='op'>=</span><span class='st'>"ns"</span>,
              spline_setback<span class='op'>=</span><span class='fl'>1</span>,
              spline_extrap<span class='op'>=</span><span class='st'>"constant"</span>,
              return_val<span class='op'>=</span><span class='st'>"X"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/matplot.html'>matplot</a></span><span class='op'>(</span><span class='va'>X</span>, ylab<span class='op'>=</span><span class='st'>""</span><span class='op'>)</span>
<span class='va'>form</span> <span class='op'>&lt;-</span>  <span class='fu'>calibrate_comb</span><span class='op'>(</span>data<span class='op'>=</span><span class='va'>dd</span>, params<span class='op'>=</span><span class='va'>params</span>,
              use_spline<span class='op'>=</span><span class='cn'>TRUE</span>,
              spline_type<span class='op'>=</span><span class='st'>"ns"</span>,
              spline_setback<span class='op'>=</span><span class='fl'>1</span>,
              spline_extrap<span class='op'>=</span><span class='st'>"constant"</span>,
              return_val<span class='op'>=</span><span class='st'>"formula"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>form</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Ben Bolker, David Earn, Morgan Kain, Mike Li, Jonathan Dushoff.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1 and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9002.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


